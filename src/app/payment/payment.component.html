<div class="payment-container container py-4">
  <div class="payment-header mb-4 text-center">
    <h2><i class="bi bi-credit-card"></i> Complete Your Payment</h2>
    <p class="order-number">Order Total: {{ orderData?.totalAmount | currency:'INR' }}</p>
  </div>

  <div class="row">
    <!-- Payment Method Section -->
    <div class="col-lg-8">
      <div class="card payment-method-card mb-4">
        <div class="card-header">
          <h4>Payment Method</h4>
        </div>
        <div class="card-body">
          <div class="d-flex gap-3 mb-3">
            <div
              *ngFor="let method of paymentMethods"
              class="payment-method p-3 border rounded cursor-pointer"
              [ngClass]="{'border-primary': selectedMethod === method.value}"
              (click)="selectedMethod = method.value"
            >
              <i class="bi" [ngClass]="{
                'bi-credit-card': method.value === PaymentMethod.CreditCard,
              
                'bi-bank': method.value === PaymentMethod.BankTransfer,
                'bi-currency-rupee': method.value === PaymentMethod.cashfree
              }"></i>
              <span class="ms-2">{{ method.label }}</span>
            </div>
          </div>

          <!-- Credit Card Form -->
          <div *ngIf="selectedMethod === PaymentMethod.CreditCard" class="mt-3">
            <div class="form-group mb-3">
              <label>Card Number</label>
              <input type="text" class="form-control"
                     [(ngModel)]="cardDetails.number"
                     (input)="formatCardNumber($event)"
                     placeholder="1234 5678 9012 3456"
                     maxlength="19">
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label>Expiry Date</label>
                <input type="text" class="form-control"
                       [(ngModel)]="cardDetails.expiry"
                       (input)="formatExpiry($event)"
                       placeholder="MM/YY"
                       maxlength="5">
              </div>
              <div class="col-md-6 mb-3">
                <label>Security Code</label>
                <input type="text" class="form-control"
                       [(ngModel)]="cardDetails.cvc"
                       placeholder="CVC"
                       maxlength="4">
              </div>
            </div>
          </div>

          <!-- UPI Payment Info -->
          <div *ngIf="selectedMethod === PaymentMethod.UPI" class="mt-3">
            <div class="alert alert-info">
              <i class="bi bi-info-circle"></i> Scan the QR code using any UPI app to make the payment.
            </div>
            <div class="text-center">
              <button class="btn btn-primary" (click)="toggleQRCode()">
                <i class="bi bi-qr-code"></i> Show QR Code
              </button>
            </div>
            <!-- QR Code Modal -->
            <div class="qr-modal" *ngIf="showQRCode" (click)="toggleQRCode()">
              <div class="qr-content" (click)="$event.stopPropagation()">
                <div class="qr-header">
                  <h5>Scan QR Code</h5>
                  <button class="close-btn" (click)="toggleQRCode()">
                    <i class="bi bi-x"></i>
                  </button>
                </div>
                <div class="qr-body">
                  <img src="assets/image.png" alt="UPI QR Code" class="qr-image">
                  <p class="mt-3">Amount: {{ orderData?.totalAmount | currency:'INR' }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Bank Transfer Info -->
          <div *ngIf="selectedMethod === PaymentMethod.BankTransfer" class="mt-3">
            <div class="alert alert-warning">
              <strong>Important:</strong> Include your reference number when transferring.
            </div>
            <table class="table table-bordered mt-2">
              <tr><th>Bank Name:</th><td>Retail Cycle Shop Bank</td></tr>
              <tr><th>Account Number:</th><td>1234567890</td></tr>
              <tr><th>IFSC Code:</th><td>RCSB0000123</td></tr>
              <tr><th>Reference:</th><td>ORDER-{{ orderData?.orderNumber || 'N/A' }}</td></tr>
            </table>
          </div>

          <!-- Cashfree Info -->
          <div *ngIf="selectedMethod === PaymentMethod.cashfree" class="alert alert-info mt-3">
            <i class="bi bi-info-circle"></i> You will be redirected to Cashfree to complete your payment securely.
          </div>
        </div>
      </div>
    </div>

    <!-- Order Summary Section -->
    <div class="col-lg-4">
      <div class="card order-summary-card">
        <div class="card-header">
          <h4>Order Summary</h4>
        </div>
        <div class="card-body">
          <div class="summary-item mb-2" *ngFor="let item of orderData?.cartItems">
            <div class="d-flex justify-content-between">
              <span>{{ item.brand }} {{ item.model }} Ã— {{ item.quantity }}</span>
              <span>{{ item.price * item.quantity | currency:'INR' }}</span>
            </div>
          </div>

          <hr>
          <div class="d-flex justify-content-between mb-2">
            <strong>Subtotal:</strong>
            <span>{{ orderData?.subtotal | currency:'INR' }}</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <strong>Tax:</strong>
            <span>{{ orderData?.tax | currency:'INR' }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <strong>Total:</strong>
            <span>{{ orderData?.totalAmount | currency:'INR' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="mt-4 d-flex justify-content-end gap-3">
    <button class="btn btn-outline-secondary" (click)="cancelPayment()">Cancel</button>
    <button class="btn btn-primary" 
            [disabled]="paymentProcessing || !isPaymentFormValid()"
            (click)="processPayment()">
      <span *ngIf="paymentProcessing" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
      {{ paymentProcessing ? 'Processing...' : 'Pay Now' }}
    </button>
  </div>
</div>